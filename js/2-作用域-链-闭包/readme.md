# 作用域-链-闭包
## 词法作用域

# Js执行机制
## 调用栈
- 管理函数的执行顺序
- 记录函数的执行顺序，管理执行上下文和变量环境。
- 栈底是全局执行上下文，栈顶是当前执行的函数的执行上下文。
- 函数的执行上下文是在函数调用时创建的，函数执行完毕后，对应的执行上下文会被销毁。
- 函数的执行上下文包含了函数的作用域链、变量环境和this值。
## 作用域
- 变量查找规则： 在当前作用域中查找变量，如果没有找到，根据作用域链就去父作用域中查找，直到找到全局作用域。
## 作用域链
- 变量查找的路径，由当前作用域和父作用域组成。 是一个数组，包含了当前作用域和父作用域的变量环境。
- 当一段代码使用一个变量时，js引擎首先会在当前执行上下文查找变量，若没有找到，就会沿着outer指向的外部作用域查找，直到找到全局作用域。
- 这样查找的路径就是作用域链。

## 执行上下文对象
- 执行上下文对象是函数执行时创建的，包含了函数的作用域链、变量环境和this值。
- 执行上下文对象是在函数调用时创建的，函数执行完毕后，对应的执行上下文会被销毁。
- 执行上下文对象是一个对象，包含了函数的作用域链、变量环境和this值。


---------------在 JavaScript 中，变量查找的顺序是 先查找词法环境（Lexical Environment），再查找变量环境（Variable Environment）
## 变量环境
- 存储用var声明的变量
- 变量环境是一个对象，包含了函数的变量和函数声明。
- 变量环境是在函数执行时创建的，函数执行完毕后，对应的变量环境会被销毁。
- 每个执行上下文变量环境中，都包含一个外部应用outer，指向外部的执行上下文变量环境。

## 词法环境 
- 用于存储let和const声明的变量，以及函数声明。
- 词法环境是一个对象，包含了函数的变量和函数声明。
- 
- TDZ


## 词法作用域
- 作用域由代码中的函数声明的位置来决定，它是静态的作用域
- 用来预测代码在执行过程中如何查找变量
- 帮助auter指向外部的执行上下文变量环境

- 它在编译阶段就确定了，不会发生变化。 和函数的调用位置无关。


# 闭包
- 函数嵌套函数，内部函数可以访问外部函数的变量。
- 基础是理解词法作用域。
- 根据词法作用域的规则，内部函数getName和setName可以访问外部函数foo的变量。
- 那为什么叫做闭包：因为内部函数总是可以访问外部函数的变量，这些变量被称为自由变量，即使外部函数已经执行完毕，内部函数仍然可以访问外部函数的变量。
- foo执行结束被销毁后，会将foo的自由变量都放入背包中，然后返回一个函数，这个函数就是innerBar
- 这些变量的集合也是内部函数运行的专属背包。


